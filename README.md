<div align = center><img src="https://capsule-render.vercel.app/api?type=waving&color=auto&height=180&section=header&text=BrickFarm&fontSize=90"/></div>
<div align = right>
<h5>ğŸ“… 2023.10.4 ~ 2023.11.30&emsp;&emsp;&emsp;&emsp;&ensp;</h5>
</div>ğŸ“ŒğŸ“ğŸ“‹&#128161;&#128163;&#128165;
<br/>
<br/>
<h2>ğŸ“ŒLanguages/Framework</h2>
<div align = center>
<img src="https://img.shields.io/badge/Java-007396?style=flat&logo=Java&logoColor=white"/>
<img src="https://img.shields.io/badge/HTML5-E34F26?style=flat&logo=HTML5&logoColor=white"/>
<img src="https://img.shields.io/badge/CSS3-1572B6?style=flat&logo=CSS3&logoColor=white"/>
<img src="https://img.shields.io/badge/Javascript-F7DF1E?style=flat&logo=Javascript&logoColor=white"/>
<img src="https://img.shields.io/badge/jQuery-0769AD?style=flat&logo=jQuery&logoColor=white"/>
<img src="https://img.shields.io/badge/Ajax-0099E5?style=flat&logo=Ajax&logoColor=white"/>
<br/>
<img src="https://img.shields.io/badge/Spring-6DB33F?style=flat&logo=Spring&logoColor=white"/>
<img src="https://img.shields.io/badge/JSP-512BD4?style=flat&logo=JSP&logoColor=white"/>
<img src="https://img.shields.io/badge/Oracle-F80000?style=flat&logo=Oracle&logoColor=white"/>
<img src="https://img.shields.io/badge/MySql-4479A1?style=flat&logo=MySql&logoColor=white"/>
<img src="https://img.shields.io/badge/MariaDB-003545?style=flat&logo=MariaDB&logoColor=white"/>
</div>

<br/>
<br/>
<h2>ğŸ“ŒSoftware</h2>
<div align = center>
<img src="https://img.shields.io/badge/Notion-000000?style=flat&logo=Notion&logoColor=white"/>
<img src="https://img.shields.io/badge/Figma-F24E1E?style=flat&logo=Figma&logoColor=white"/>
<img src="https://img.shields.io/badge/GoogleSheets-34A853?style=flat&logo=GoogleSheets&logoColor=white"/>
<img src="https://img.shields.io/badge/Git-F05032?style=flat&logo=Git&logoColor=white"/>
<img src="https://img.shields.io/badge/GitHub-181717?style=flat&logo=GitHub&logoColor=white"/>
<br/>
<img src="https://img.shields.io/badge/NaverAPI-03C75A?style=flat&logo=Naver&logoColor=white"/>
<img src="https://img.shields.io/badge/KakaoAPI-FFCD00?style=flat&logo=Kakao&logoColor=white"/>
<img src="https://img.shields.io/badge/Eclipse IDE-2c2255?style=flat&logo=EclipseIDE&logoColor=white"/>
<img src="https://img.shields.io/badge/Apache Tomcat-F8DC75?style=flat&logo=apachetomcat&logoColor=white"/>
</div>

<br/>
<br/>
<h2>ğŸ“Œê°œë…ì ERD</h2>
<img width="900" alt="ê°œë…ì ERD" src="https://github.com/SsongYT/BrickFarm-Project/assets/136442036/08d7a97f-0174-49e3-97af-c2da6e60eab8"/>

 <br/>
 <br/>
<h2>ğŸ“Œê³µí•™ì ERD</h2> 
<img width="900" alt="ê³µí•™ì ERD" src="https://github.com/SsongYT/BrickFarm-Project/assets/136442036/bb03cd58-2a29-49d9-810f-41869f2a2bb7"/>

<br/>
<br/>
<h2>ğŸ“Œì‚¬ì´íŠ¸ë§µ</h2>
<img width="900" alt="ì‚¬ì´íŠ¸ë§µ" src="https://github.com/SsongYT/BrickFarm-Project/assets/136442036/46495df8-4652-4e92-b668-54b0115e0bda"/>

<br/>
<br/>
<h2>ğŸ†ë‹´ë‹¹ : ê²°ì œ ë° ê´€ë¦¬ì-ì£¼ë¬¸</h2>

>ê¼¼ê¼¼í•œ ê²°ì œì²˜ë¦¬
>
>ë¶€ë¶„ì·¨ì†Œ ê¸°ëŠ¥ êµ¬í˜„
>
>í¸ë¦¬í•œ ê´€ë¦¬ê¸°ëŠ¥

<br/>
<br/>
<h3>ğŸ“ì£¼ìš” DBí…Œì´ë¸” ì†Œê°œ</h3>
<img width="900" alt="í…Œì´ë¸”" src="https://github.com/SsongYT/BrickFarm-Project/assets/136442036/02fbf6b4-a407-4d8b-86ed-ae6737df6379"/>
    
>ì „ì²´ìƒí’ˆì˜ ë¶€ë¶„ì·¨ì†Œ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê¸°ìœ„í•´ ordersheetì— ê° ì„¸ë¶€ìƒí’ˆì´ ìˆëŠ” detailed_order í…Œì´ë¸”ë¡œ êµ¬ë¶„í•˜ì—¬ êµ¬í˜„í•˜ê³ 
>
>ê·¸ í›„ ì·¨ì†Œ/êµí™˜/ë°˜í’ˆ/êµ¬ë§¤í™•ì •ì„ detailed_order í…Œì´ë¸”ì—ì„œ ì´ë£¨ì–´ì§€ë„ë¡ ì„¤ê³„í•˜ì—¬ í…Œì´ë¸”ì„ êµ¬ì„±í•˜ì˜€ë‹¤.
>
>ì ë¦½ê¸ˆì€ ìƒí’ˆë³„ë¡œ ì‚¬ìš©í•˜ë„ë¡ ë§Œë“¤ë©´ ê³ ê° í¸ì˜ì„±ì´ ë–¨ì–´ì§€ê²Œ ë˜ê³  ê· ë“±í•˜ê²Œ ë¶„ë°°í•˜ë©´ ì·¨ì†Œ/ë°˜í’ˆì‹œ ë¬¸ì œê°€ ìˆë‹¤ê³  íŒë‹¨í•˜ì—¬
>
>ì·¨ì†Œ/ë°˜í’ˆì‹œ ì½”ë“œì ìœ¼ë¡œ ì´ë¶€ë¶„ì„ ê³„ì‚°í•˜ì—¬ ê²°ì œê¸ˆì•¡ì„ ë°˜í™˜í•˜ë„ë¡ í•˜ì˜€ë‹¤.

<br/>
<br/>
<h3>ğŸ“ê²°ì œ ê²€ì¦</h3>
<img width="900" alt="ê²°ì œ ê²€ì¦" src="https://github.com/SsongYT/BrickFarm-Project/assets/136442036/4f483ac5-9017-4a5a-8c64-a3a3b2276004"/>

> javascript ì—ì„œ ê²°ì œAPIë¥¼ ì´ìš©í•œ ê²°ì œ ì´í›„ scriptì˜ ì¡°ì‘ìœ¼ë¡œ ë°ì´í„° ìœ„ë³€ì¡°ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´
>
> DBì—ì„œ ê²€ì¦ë°ì´í„°ë¥¼ ê°€ì§€ê³ ì™€ controllerì™€ survice ì—ì„œ ì¶”í›„ ê²€ì¦ì„ ì‹¤ì‹œí•˜ì˜€ê³ 
>
> ì‹¤íŒ¨ì‹œ errorCodeë¥¼ ë°˜í™˜í•˜ì—¬ ì¶œë ¥í•˜ë„ë¡ ì¡°ì¹˜í•˜ì˜€ë‹¤.

<br/>
<br/>
<h4>&#128161;ì½”ë“œ ë¶„ì„</h4>

<h4>&#128163; Controller</h4>

```java
@PostMapping(value="orderCompletePage") 
public void inputCompleteOrder(@ModelAttribute UserOrdersheetDTO ordersheet, @ModelAttribute UserPaymentDTO payment,
@ModelAttribute UserCompleteDataDTO completeData, @RequestParam List<String> product_code,
@RequestParam List<Integer> quantity, HttpServletRequest request, Model model) {
  //ì„¸ì…˜ ì •ë³´ë¥¼ í†µí•´ ë©¤ë²„ ì •ë³´ ë°›ì•„ì˜¤ê¸°
  UserMemberVO sessionMember = (UserMemberVO)request.getSession().getAttribute("loginMemberInfo");
  List<UserPaymentListDTO> paymentList = new ArrayList<UserPaymentListDTO>();

  for (int i = 0; i < product_code.size(); i++) {
    UserPaymentListDTO paymentData = new UserPaymentListDTO(product_code.get(i), quantity.get(i));
    paymentList.add(paymentData);
  }
		
  try {
    UserMemberVO member = paymentService.getMember(sessionMember.getMember_no());
    Map<String, Object> result = paymentService.makeCompleteOrderByDataToUse(ordersheet, payment, completeData, paymentList, member);	
    String errorCode = (String)result.get("errorCode");
    if(errorCode == "000") {
      UserOrdersheetDTO ordersheetData = (UserOrdersheetDTO)result.get("ordersheet");
      UserPaymentDTO paymentData = (UserPaymentDTO)result.get("payment");
      List<UserOrderProductDTO> orderProductList = (List<UserOrderProductDTO>)result.get("orderProductList");
      int total_price = (int)result.get("total_price");
      int coupon_discounted_price = (int)result.get("coupon_discounted_price");
		
      model.addAttribute("ordersheet", ordersheetData);
      model.addAttribute("payment", paymentData);
      model.addAttribute("orderProductList", orderProductList);
      model.addAttribute("paymentType", completeData.getPaymentType());
      model.addAttribute("total_price", total_price);
      model.addAttribute("coupon_discounted_price", coupon_discounted_price);
    } 
    // ê²€ì¦ ì‹¤íŒ¨ì— ëŒ€í•œ ì—ëŸ¬ì½”ë“œ (ì¿ í°,í¬ì¸íŠ¸,ì¬ê³ ,ê²°ì œê²€ì¦)
    model.addAttribute("errorCode", errorCode);

  } catch (Exception e) { // ê²€ì¦ê³¼ ìƒê´€ì—†ì´ DBì •ë³´ ì €ì¥ì‹œ Exceptionì—ëŸ¬ì½”ë“œ
    e.printStackTrace();
    Map<String, Object> errorResponse = new HashMap<String, Object>();
    errorResponse.put("createdAt", new Timestamp(System.currentTimeMillis()));
    errorResponse.put("errorMessage", "ì‹œìŠ¤í…œì—ëŸ¬");	
    int errorCode = 999;
		
    model.addAttribute("errorCode", errorCode);
    model.addAttribute("errorResponse", errorResponse);
  }
}
```

<h4>&#128163; Survice</h4>

```java
// ì¬ê³ ,ì¿ í°ë³´ìœ ,í¬ì¸íŠ¸ë³´ìœ  ê²€ì¦
@Override
public String verifyAll(int member_no, int point_pay_money, int coupon_held_no, List<UserPaymentListDTO> paymentList) 
throws Exception {
  String result = null;
  int intVerify = 9000;
  int verifyQuantity = 1;
  int verifyCoupon = 1;
  int verifyPoint = 1;
		
  // ì¬ê³  ê²€ì¦ (ì„±ê³µ 0 , ì‹¤íŒ¨ ìŒìˆ˜)
  if (stockDao.isVerifyStock(paymentList) != 0) { 
    verifyQuantity = -1;
    intVerify += 200;
  } 
		
  // ì¿ í° ê²€ì¦ (ì„±ê³µ 1 , ì‹¤íŒ¨ 0)
  if (coupon_held_no != -1) {
    if(memberDao.verifyCoupon(member_no, coupon_held_no) != 1) {
      verifyCoupon = -1;	
      intVerify += 20;
    } 		
  } 
		
  // í¬ì¸íŠ¸ ê²€ì¦ (ì„±ê³µ1, ì‹¤íŒ¨ -1)
  if (point_pay_money > 0) {
    if(memberDao.verifyPoint(member_no, point_pay_money) != 1) {
      verifyPoint = -1;
      intVerify += 2;
    }		
  } 
		
  // ì™„ì „ ê²€ì¦
  if (verifyQuantity == 1 && verifyCoupon == 1 && verifyPoint == 1) {
    result = "000";
  } else {
    String verify = Integer.toString(intVerify);
    result = verify.substring(verify.length()-3, verify.length());
  }
		
  return result;
}
//----------------------------------------------------------------------------------------------------------------
//ê²°ì œê¸ˆì•¡DBì—ì„œ ê³„ì‚°
@Override
public int getValidationPrice(List<UserPaymentListDTO> paymentList, int coupon_held_no, int post_money, int point_pay_money) throws Exception {		
  int totalPrice = detailedOrderDao.getValidationPrice(paymentList);
  float couponDiscountRate = 0;
  if (coupon_held_no != -1) {
    couponDiscountRate = couponHeldDao.getValidationRate(coupon_held_no);
  }

  int validationPrice = totalPrice - (Math.round(totalPrice * couponDiscountRate)) + post_money - point_pay_money;

  return validationPrice;
}

//----------------------------------------------------------------------------------------------------------------
//ê²°ì œ ê²€ì¦
public IamportResponse<Payment> verifyPayment(int pay_money, String imp_uid) throws IamportResponseException, IOException {
  IamportResponse<Payment> verifyPayment = null;
  IamportResponse<Payment> responsePayment = paymentByImpUid(imp_uid);
  //DBë°ì´í„°ë¡œ ê³„ì‚°í•œ ê²°ì œê¸ˆì•¡ê³¼ ìš”ì²­ëœ ê²°ì œê¸ˆì•¡ ë¹„êµ
  if(responsePayment.getResponse().getAmount().intValue() == pay_money) {
    verifyPayment = responsePayment;
  }
  return verifyPayment;
}

//----------------------------------------------------------------------------------------------------------------
//survice ë‹¨ì—ì„œ ê²€ì¦í›„ ì²˜ë¦¬
@Override
public Map<String, Object> makeCompleteOrderByDataToUse(UserOrdersheetDTO ordersheet, UserPaymentDTO payment,
UserCompleteDataDTO completeData, List<UserPaymentListDTO> paymentList, UserMemberVO member) throws Exception {
  Map<String, Object> result = new HashMap<String, Object>();
  String errorCode = "000";
  // ì¬ê³ ,ì¿ í°,ì ë¦½ê¸ˆ ê²€ì¦
  String verifyCode = verifyAll(member.getMember_no(), payment.getPoint_pay_money(), ordersheet.getCoupon_held_no(), paymentList);
  if (verifyCode.equals("000")) {	//ê²€ì¦ì„±ê³µ
  // ê²€ì¦ì„ ìœ„í•œ ê¸ˆì•¡ ê³„ì‚° ( ë°‘ì— 100ëŒ€ì‹  validationPrice )
    int validationPrice = getValidationPrice(paymentList, ordersheet.getCoupon_held_no(), payment.getPost_money(), payment.getPoint_pay_money());
    // ê²°ì œì•¡ì´ 0ì›ì´ ì•„ë‹ë•Œ ê²°ì œAPI ê²€ì¦ì„í•¨.
    if(completeData.getPay_money() != 0) {
      // ê²€ì¦í•¨ìˆ˜ í˜¸ì¶œí•˜ì—¬ ë¦¬í„´ ê°’ ë°›ì•„ì˜¤ê¸°
      IamportResponse<Payment> responsePayment = PaymentInfo.getInstance().verifyPayment(validationPrice, payment.getImp_uid());
      if (responsePayment != null) {

        ...ê²°ì œ ì„±ê³µì‹œ ë¡œì§ ìˆ˜í–‰...

      } else if(responsePayment == null) { // ê²°ì œ ê²€ì¦ ì‹¤íŒ¨
        //ì¹´ë“œê²°ì œ ì·¨ì†Œ
        if (completeData.getPaymentType().equals("card")) {
          BigDecimal cancel_request_amount = new BigDecimal(completeData.getPay_money());
          BigDecimal checksum = new BigDecimal(completeData.getPay_money());
          CancelDataDTO cancelData = new CancelDataDTO(payment.getImp_uid(), cancel_request_amount, "ê²€ì¦ì‹¤íŒ¨", checksum);
          PaymentInfo.getInstance().cancelPaymentByImpUid(cancelData);	
        }

        errorCode = "001";
        result.put("errorCode", errorCode);
      }
    } else if(completeData.getPay_money() == 0){

      ...ê²°ì œ ê¸ˆì•¡ 0ì›ì¼ë•Œ ë¡œì§...

    }

  } else if(!verifyCode.equals("000") { // ìœ íš¨ì„± 3ê°€ì§€ ì¤‘ 1ê°œë¼ë„ ì‹¤íŒ¨
    if (completeData.getPaymentType().equals("card")) {
      BigDecimal cancel_request_amount = new BigDecimal(completeData.getPay_money());
      BigDecimal checksum = new BigDecimal(completeData.getPay_money());
      CancelDataDTO cancelData = new CancelDataDTO(payment.getImp_uid(), cancel_request_amount, "ê²€ì¦ì‹¤íŒ¨", checksum);
      PaymentInfo.getInstance().cancelPaymentByImpUid(cancelData);
    }
    errorCode = verifyCode;
    result.put("errorCode", errorCode);

  }
  return result;
}

```
<h4>&#128165;í‰ê°€</h4>

> errorCodeë¥¼ ì¬ê³ ë¬¸ì œì‹œ ë°±ì˜ìë¦¬, ì¿ í°ë¬¸ì œì‹œ ì‹­ì˜ìë¦¬, ì ë¦½ê¸ˆë¬¸ì œì‹œ ì¼ì˜ìë¦¬ë¡œ í‘œí˜„í•˜ì—¬ 
>
> ë³µí•©ì  ë¬¸ì œë„ í‘œí˜„í•˜ê³  ì‹¶ì—ˆëŠ”ë° ê²½ìš°ì˜ìˆ˜ ë‹¤ì–‘ì„±ìœ¼ë¡œ ë·°ë‹¨ì— ì½”ë“œê°€ ê¸¸ì–´ì§€ëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ì˜€ë‹¤.
>
> ì´ë¶€ë¶„ì„ ê¹”ë”í•˜ê²Œ ì²˜ë¦¬í•˜ê³  ì‹¶ì—ˆì§€ë§Œ ì‹œê°„ìƒì˜ ë¬¸ì œë¡œ êµ¬í˜„í•˜ì§€ ëª»í•˜ê³ 
>
> ê·¸ëƒ¥ 3ê°€ì§€ ìœ íš¨ì„±ë¬¸ì œë¥¼ ìœ íš¨ì„±ê²€ì¦ì‹¤íŒ¨ 1ê°€ì§€ë¡œ ì¶œë ¥í•˜ê²Œë˜ì—ˆëŠ”ë° 
>
> ë‹¤ìŒë²ˆì—ëŠ” ì´ë¶€ë¶„ì„ HandlerExceptionResolver ì¸í„°í˜ì´ìŠ¤ë‚˜ ì²´ê³„ì ErrorResponse íŒŒì¼ì„ ë§Œë“¤ì–´
>
> ë³´ë‹¤ ì „ëµì ìœ¼ë¡œ error ë° Exception ê´€ë¦¬ë¥¼ ì‹œë„í•´ë³´ê³  ì‹¶ë‹¤.

***

<h3>ğŸ“ê²°ì œ ì·¨ì†Œ</h3>
<img width="900" alt="ê²°ì œ ì·¨ì†Œ" src="https://github.com/SsongYT/BrickFarm-Project/assets/136442036/39eda5d7-3c30-406b-9c0d-940b9da1a64a"/>
<h3>ğŸ“ìƒíƒœ í™•ì •</h3>
<img width="900" alt="ìƒíƒœ í™•ì •" src="https://github.com/SsongYT/BrickFarm-Project/assets/136442036/eb8432a8-8856-45f7-8c43-a833325ab220"/>
