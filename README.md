<div align = center><img src="https://capsule-render.vercel.app/api?type=waving&color=auto&height=180&section=header&text=BrickFarm&fontSize=90"/></div>
<div align = right>
<h5>ğŸ“… 2023.10.4 ~ 2023.11.30&emsp;&emsp;&emsp;&emsp;&ensp;</h5>
</div>
<br/>
<br/>
<h1>ğŸ“ŒLanguages/Framework</h1>
<div align = center>
<img src="https://img.shields.io/badge/Java-007396?style=flat&logo=Java&logoColor=white"/>
<img src="https://img.shields.io/badge/HTML5-E34F26?style=flat&logo=HTML5&logoColor=white"/>
<img src="https://img.shields.io/badge/CSS3-1572B6?style=flat&logo=CSS3&logoColor=white"/>
<img src="https://img.shields.io/badge/Javascript-F7DF1E?style=flat&logo=Javascript&logoColor=white"/>
<img src="https://img.shields.io/badge/jQuery-0769AD?style=flat&logo=jQuery&logoColor=white"/>
<img src="https://img.shields.io/badge/Ajax-0099E5?style=flat&logo=Ajax&logoColor=white"/>
<br/>
<img src="https://img.shields.io/badge/Spring-6DB33F?style=flat&logo=Spring&logoColor=white"/>
<img src="https://img.shields.io/badge/JSP-512BD4?style=flat&logo=JSP&logoColor=white"/>
<img src="https://img.shields.io/badge/Oracle-F80000?style=flat&logo=Oracle&logoColor=white"/>
<img src="https://img.shields.io/badge/MySql-4479A1?style=flat&logo=MySql&logoColor=white"/>
<img src="https://img.shields.io/badge/MariaDB-003545?style=flat&logo=MariaDB&logoColor=white"/>
</div>
<br/>
<br/>
<h1>ğŸ“ŒSoftware</h1>
<div align = center>
<img src="https://img.shields.io/badge/Notion-000000?style=flat&logo=Notion&logoColor=white"/>
<img src="https://img.shields.io/badge/Figma-F24E1E?style=flat&logo=Figma&logoColor=white"/>
<img src="https://img.shields.io/badge/GoogleSheets-34A853?style=flat&logo=GoogleSheets&logoColor=white"/>
<img src="https://img.shields.io/badge/Git-F05032?style=flat&logo=Git&logoColor=white"/>
<img src="https://img.shields.io/badge/GitHub-181717?style=flat&logo=GitHub&logoColor=white"/>
<br/>
<img src="https://img.shields.io/badge/NaverAPI-03C75A?style=flat&logo=Naver&logoColor=white"/>
<img src="https://img.shields.io/badge/KakaoAPI-FFCD00?style=flat&logo=Kakao&logoColor=white"/>
<img src="https://img.shields.io/badge/Eclipse IDE-2c2255?style=flat&logo=EclipseIDE&logoColor=white"/>
<img src="https://img.shields.io/badge/Apache Tomcat-F8DC75?style=flat&logo=apachetomcat&logoColor=white"/>
</div>
<br/>
<br/>
<h1>ğŸ“Œê°œë…ì ERD</h1>
<img width="900" alt="ê°œë…ì ERD" src="https://github.com/SsongYT/BrickFarm-Project/assets/136442036/08d7a97f-0174-49e3-97af-c2da6e60eab8"/>
<br/>
<br/>
<h1>ğŸ“Œê³µí•™ì ERD</h1> 
<img width="900" alt="ê³µí•™ì ERD" src="https://github.com/SsongYT/BrickFarm-Project/assets/136442036/bb03cd58-2a29-49d9-810f-41869f2a2bb7"/>
<br/>
<br/>
<h1>ğŸ“Œì‚¬ì´íŠ¸ë§µ</h1>
<img width="900" alt="ì‚¬ì´íŠ¸ë§µ" src="https://github.com/SsongYT/BrickFarm-Project/assets/136442036/46495df8-4652-4e92-b668-54b0115e0bda"/>
<br/>
<br/>
<h1>ğŸ†ë‹´ë‹¹ : ê²°ì œ ë° ê´€ë¦¬ìí˜ì´ì§€(ì£¼ë¬¸)</h1>

>ê¼¼ê¼¼í•œ ê²°ì œì²˜ë¦¬
>
>ë¶€ë¶„ì·¨ì†Œ ê¸°ëŠ¥ êµ¬í˜„
>
>í¸ë¦¬í•œ ê´€ë¦¬ê¸°ëŠ¥
<br/>
<h2>ğŸ“ì£¼ìš” DBí…Œì´ë¸” ì†Œê°œ</h2>
<img width="900" alt="í…Œì´ë¸”" src="https://github.com/SsongYT/BrickFarm-Project/assets/136442036/02fbf6b4-a407-4d8b-86ed-ae6737df6379"/>
    
>ì „ì²´ìƒí’ˆì˜ ë¶€ë¶„ì·¨ì†Œ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê¸°ìœ„í•´ ordersheetì— ê° ì„¸ë¶€ìƒí’ˆì´ ìˆëŠ” detailed_order í…Œì´ë¸”ë¡œ êµ¬ë¶„í•˜ì—¬ êµ¬í˜„í•˜ê³ 
>
>ê·¸ í›„ ì·¨ì†Œ/êµí™˜/ë°˜í’ˆ/êµ¬ë§¤í™•ì •ì„ detailed_order í…Œì´ë¸”ì—ì„œ ì´ë£¨ì–´ì§€ë„ë¡ ì„¤ê³„í•˜ì—¬ í…Œì´ë¸”ì„ êµ¬ì„±í•˜ì˜€ë‹¤.
>
>ì ë¦½ê¸ˆì€ ìƒí’ˆë³„ë¡œ ì‚¬ìš©í•˜ë„ë¡ ë§Œë“¤ë©´ ê³ ê° í¸ì˜ì„±ì´ ë–¨ì–´ì§€ê²Œ ë˜ê³  ê· ë“±í•˜ê²Œ ë¶„ë°°í•˜ë©´ ì·¨ì†Œ/ë°˜í’ˆì‹œ ë¬¸ì œê°€ ìˆë‹¤ê³  íŒë‹¨í•˜ì—¬
>
>ì·¨ì†Œ/ë°˜í’ˆì‹œ ì½”ë“œì ìœ¼ë¡œ ì´ë¶€ë¶„ì„ ê³„ì‚°í•˜ì—¬ ê²°ì œê¸ˆì•¡ì„ ë°˜í™˜í•˜ë„ë¡ í•˜ì˜€ë‹¤.
<br/>
<h2>ğŸ“ê²°ì œ ê²€ì¦</h2>
<img width="900" alt="ê²°ì œ ê²€ì¦" src="https://github.com/SsongYT/BrickFarm-Project/assets/136442036/4f483ac5-9017-4a5a-8c64-a3a3b2276004"/>

> javascript ì—ì„œ ê²°ì œAPIë¥¼ ì´ìš©í•œ ê²°ì œ ì´í›„ scriptì˜ ì¡°ì‘ìœ¼ë¡œ ë°ì´í„° ìœ„ë³€ì¡°ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´
>
> DBì—ì„œ ê²€ì¦ë°ì´í„°ë¥¼ ê°€ì§€ê³ ì™€ controllerì™€ survice ì—ì„œ ì¶”í›„ ê²€ì¦ì„ ì‹¤ì‹œí•˜ì˜€ê³ 
>
> ì‹¤íŒ¨ì‹œ errorCodeë¥¼ ë°˜í™˜í•˜ì—¬ ì¶œë ¥í•˜ë„ë¡ ì¡°ì¹˜í•˜ì˜€ë‹¤.
<br/>
<h3>ğŸ’¡ì½”ë“œ ë¶„ì„</h3>

<h4>ğŸ’£Controller</h4>

```java
@PostMapping(value="orderCompletePage") 
public void inputCompleteOrder(@ModelAttribute UserOrdersheetDTO ordersheet, @ModelAttribute UserPaymentDTO payment,
@ModelAttribute UserCompleteDataDTO completeData, @RequestParam List<String> product_code,
@RequestParam List<Integer> quantity, HttpServletRequest request, Model model) {
  //ì„¸ì…˜ ì •ë³´ë¥¼ í†µí•´ ë©¤ë²„ ì •ë³´ ë°›ì•„ì˜¤ê¸°
  UserMemberVO sessionMember = (UserMemberVO)request.getSession().getAttribute("loginMemberInfo");
  List<UserPaymentListDTO> paymentList = new ArrayList<UserPaymentListDTO>();

  for (int i = 0; i < product_code.size(); i++) {
    UserPaymentListDTO paymentData = new UserPaymentListDTO(product_code.get(i), quantity.get(i));
    paymentList.add(paymentData);
  }
		
  try {
    UserMemberVO member = paymentService.getMember(sessionMember.getMember_no());
    Map<String, Object> result = paymentService.makeCompleteOrderByDataToUse(ordersheet, payment, completeData, paymentList, member);	
    String errorCode = (String)result.get("errorCode");
    if(errorCode == "000") {
      UserOrdersheetDTO ordersheetData = (UserOrdersheetDTO)result.get("ordersheet");
      UserPaymentDTO paymentData = (UserPaymentDTO)result.get("payment");
      List<UserOrderProductDTO> orderProductList = (List<UserOrderProductDTO>)result.get("orderProductList");
      int total_price = (int)result.get("total_price");
      int coupon_discounted_price = (int)result.get("coupon_discounted_price");
		
      model.addAttribute("ordersheet", ordersheetData);
      model.addAttribute("payment", paymentData);
      model.addAttribute("orderProductList", orderProductList);
      model.addAttribute("paymentType", completeData.getPaymentType());
      model.addAttribute("total_price", total_price);
      model.addAttribute("coupon_discounted_price", coupon_discounted_price);
    } 
    // ê²€ì¦ ì‹¤íŒ¨ì— ëŒ€í•œ ì—ëŸ¬ì½”ë“œ (ì¿ í°,í¬ì¸íŠ¸,ì¬ê³ ,ê²°ì œê²€ì¦)
    model.addAttribute("errorCode", errorCode);

  } catch (Exception e) { // ê²€ì¦ê³¼ ìƒê´€ì—†ì´ DBì •ë³´ ì €ì¥ì‹œ Exceptionì—ëŸ¬ì½”ë“œ
    e.printStackTrace();
    Map<String, Object> errorResponse = new HashMap<String, Object>();
    errorResponse.put("createdAt", new Timestamp(System.currentTimeMillis()));
    errorResponse.put("errorMessage", "ì‹œìŠ¤í…œì—ëŸ¬");	
    int errorCode = 999;
		
    model.addAttribute("errorCode", errorCode);
    model.addAttribute("errorResponse", errorResponse);
  }
}
```

<h4>ğŸ’£Survice</h4>

```java
// ì¬ê³ ,ì¿ í°ë³´ìœ ,í¬ì¸íŠ¸ë³´ìœ  ê²€ì¦
@Override
public String verifyAll(int member_no, int point_pay_money, int coupon_held_no, List<UserPaymentListDTO> paymentList) 
throws Exception {
  String result = null;
  int intVerify = 9000;
  int verifyQuantity = 1;
  int verifyCoupon = 1;
  int verifyPoint = 1;
		
  // ì¬ê³  ê²€ì¦ (ì„±ê³µ 0 , ì‹¤íŒ¨ ìŒìˆ˜)
  if (stockDao.isVerifyStock(paymentList) != 0) { 
    verifyQuantity = -1;
    intVerify += 200;
  } 
		
  // ì¿ í° ê²€ì¦ (ì„±ê³µ 1 , ì‹¤íŒ¨ 0)
  if (coupon_held_no != -1) {
    if(memberDao.verifyCoupon(member_no, coupon_held_no) != 1) {
      verifyCoupon = -1;	
      intVerify += 20;
    } 		
  } 
		
  // í¬ì¸íŠ¸ ê²€ì¦ (ì„±ê³µ1, ì‹¤íŒ¨ -1)
  if (point_pay_money > 0) {
    if(memberDao.verifyPoint(member_no, point_pay_money) != 1) {
      verifyPoint = -1;
      intVerify += 2;
    }		
  } 
		
  // ì™„ì „ ê²€ì¦
  if (verifyQuantity == 1 && verifyCoupon == 1 && verifyPoint == 1) {
    result = "000";
  } else {
    String verify = Integer.toString(intVerify);
    result = verify.substring(verify.length()-3, verify.length());
  }
		
  return result;
}

//----------------------------------------------------------------------------------------------------------------
//ê²°ì œê¸ˆì•¡DBì—ì„œ ê³„ì‚°
@Override
public int getValidationPrice(List<UserPaymentListDTO> paymentList, int coupon_held_no, int post_money, int point_pay_money) throws Exception {		
  int totalPrice = detailedOrderDao.getValidationPrice(paymentList);
  float couponDiscountRate = 0;
  if (coupon_held_no != -1) {
    couponDiscountRate = couponHeldDao.getValidationRate(coupon_held_no);
  }

  int validationPrice = totalPrice - (Math.round(totalPrice * couponDiscountRate)) + post_money - point_pay_money;

  return validationPrice;
}

//----------------------------------------------------------------------------------------------------------------
//ê²°ì œ ê²€ì¦
public IamportResponse<Payment> verifyPayment(int pay_money, String imp_uid) throws IamportResponseException, IOException {
  IamportResponse<Payment> verifyPayment = null;
  IamportResponse<Payment> responsePayment = paymentByImpUid(imp_uid);
  //DBë°ì´í„°ë¡œ ê³„ì‚°í•œ ê²°ì œê¸ˆì•¡ê³¼ ìš”ì²­ëœ ê²°ì œê¸ˆì•¡ ë¹„êµ
  if(responsePayment.getResponse().getAmount().intValue() == pay_money) {
    verifyPayment = responsePayment;
  }
  return verifyPayment;
}

//----------------------------------------------------------------------------------------------------------------
//survice ë‹¨ì—ì„œ ê²€ì¦í›„ ì²˜ë¦¬
@Override
public Map<String, Object> makeCompleteOrderByDataToUse(UserOrdersheetDTO ordersheet, UserPaymentDTO payment,
UserCompleteDataDTO completeData, List<UserPaymentListDTO> paymentList, UserMemberVO member) throws Exception {
  Map<String, Object> result = new HashMap<String, Object>();
  String errorCode = "000";
  // ì¬ê³ ,ì¿ í°,ì ë¦½ê¸ˆ ê²€ì¦
  String verifyCode = verifyAll(member.getMember_no(), payment.getPoint_pay_money(), ordersheet.getCoupon_held_no(), paymentList);
  if (verifyCode.equals("000")) {	//ê²€ì¦ì„±ê³µ
  // ê²€ì¦ì„ ìœ„í•œ ê¸ˆì•¡ ê³„ì‚° ( ë°‘ì— 100ëŒ€ì‹  validationPrice )
    int validationPrice = getValidationPrice(paymentList, ordersheet.getCoupon_held_no(), payment.getPost_money(), payment.getPoint_pay_money());
    // ê²°ì œì•¡ì´ 0ì›ì´ ì•„ë‹ë•Œ ê²°ì œAPI ê²€ì¦ì„í•¨.
    if(completeData.getPay_money() != 0) {
      // ê²€ì¦í•¨ìˆ˜ í˜¸ì¶œí•˜ì—¬ ë¦¬í„´ ê°’ ë°›ì•„ì˜¤ê¸°
      IamportResponse<Payment> responsePayment = PaymentInfo.getInstance().verifyPayment(validationPrice, payment.getImp_uid());
      if (responsePayment != null) {

        ...ê²°ì œ ì„±ê³µì‹œ ë¡œì§ ìˆ˜í–‰...

      } else if(responsePayment == null) { // ê²°ì œ ê²€ì¦ ì‹¤íŒ¨
        //ì¹´ë“œê²°ì œ ì·¨ì†Œ
        if (completeData.getPaymentType().equals("card")) {
          BigDecimal cancel_request_amount = new BigDecimal(completeData.getPay_money());
          BigDecimal checksum = new BigDecimal(completeData.getPay_money());
          CancelDataDTO cancelData = new CancelDataDTO(payment.getImp_uid(), cancel_request_amount, "ê²€ì¦ì‹¤íŒ¨", checksum);
          PaymentInfo.getInstance().cancelPaymentByImpUid(cancelData);	
        }

        errorCode = "001";
        result.put("errorCode", errorCode);
      }
    } else if(completeData.getPay_money() == 0){

      ...ê²°ì œ ê¸ˆì•¡ 0ì›ì¼ë•Œ ë¡œì§...

    }

  } else if(!verifyCode.equals("000") { // ìœ íš¨ì„± 3ê°€ì§€ ì¤‘ 1ê°œë¼ë„ ì‹¤íŒ¨
    if (completeData.getPaymentType().equals("card")) {
      BigDecimal cancel_request_amount = new BigDecimal(completeData.getPay_money());
      BigDecimal checksum = new BigDecimal(completeData.getPay_money());
      CancelDataDTO cancelData = new CancelDataDTO(payment.getImp_uid(), cancel_request_amount, "ê²€ì¦ì‹¤íŒ¨", checksum);
      PaymentInfo.getInstance().cancelPaymentByImpUid(cancelData);
    }
    errorCode = verifyCode;
    result.put("errorCode", errorCode);

  }
  return result;
}
```
</br>
<h3>ğŸ’¥í‰ê°€</h3>

> errorCodeë¥¼ ì¬ê³ ë¬¸ì œì‹œ ë°±ì˜ìë¦¬, ì¿ í°ë¬¸ì œì‹œ ì‹­ì˜ìë¦¬, ì ë¦½ê¸ˆë¬¸ì œì‹œ ì¼ì˜ìë¦¬ë¡œ í‘œí˜„í•˜ì—¬ 
>
> ë³µí•©ì  ë¬¸ì œë„ í‘œí˜„í•˜ê³  ì‹¶ì—ˆëŠ”ë° ê²½ìš°ì˜ìˆ˜ ë‹¤ì–‘ì„±ìœ¼ë¡œ ë·°ë‹¨ì— ì½”ë“œê°€ ê¸¸ì–´ì§€ëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ì˜€ë‹¤.
>
> ì´ë¶€ë¶„ì„ ê¹”ë”í•˜ê²Œ ì²˜ë¦¬í•˜ê³  ì‹¶ì—ˆì§€ë§Œ ì‹œê°„ìƒì˜ ë¬¸ì œë¡œ êµ¬í˜„í•˜ì§€ ëª»í•˜ê³ 
>
> ê·¸ëƒ¥ 3ê°€ì§€ ìœ íš¨ì„±ë¬¸ì œë¥¼ ìœ íš¨ì„±ê²€ì¦ì‹¤íŒ¨ 1ê°€ì§€ë¡œ ì¶œë ¥í•˜ê²Œë˜ì—ˆëŠ”ë° 
>
> ë‹¤ìŒë²ˆì—ëŠ” ì´ë¶€ë¶„ì„ HandlerExceptionResolver ì¸í„°í˜ì´ìŠ¤ë‚˜ ì²´ê³„ì ErrorResponse íŒŒì¼ì„ ë§Œë“¤ì–´
>
> ë³´ë‹¤ ì „ëµì ìœ¼ë¡œ error ë° Exception ê´€ë¦¬ë¥¼ ì‹œë„í•´ë³´ê³  ì‹¶ë‹¤.

***
<br/>
<br/>
<h2>ğŸ“ê²°ì œ ì·¨ì†Œ</h2>
<img width="900" alt="ê²°ì œ ì·¨ì†Œ" src="https://github.com/SsongYT/BrickFarm-Project/assets/136442036/39eda5d7-3c30-406b-9c0d-940b9da1a64a"/>

> ë¶€ë¶„ì·¨ì†Œë¥¼ êµ¬í˜„í•˜ì˜€ê³  ë¶€ë¶„ì·¨ì†Œì— ë”°ë¥¸ ë°°ì†¡ë¹„ ë¬¸ì œì™€ ê²°ì œ ì¢…ë¥˜ì— ë”°ë¥¸ ë¬¸ì œê°€ ë°œìƒí•˜ì˜€ê³ 
>
> ì´ì— ë”°ë¥¸ ê³„ì‚°ì„ í•˜ì—¬ ì·¨ì†Œë¥¼ ì§„í–‰í•˜ë„ë¡ êµ¬í˜„í•˜ì˜€ë‹¤.
>
> ë°°ì†¡ë¹„ì˜ ê²½ìš°ëŠ” ê³¼ì‹¤ìœ ë¬´ íŒë‹¨í•˜ê³  ë˜ ë¬´ë£Œë°°ì†¡ê¸°ì¤€ì— ë¶€í•©í•˜ëŠ”ì§€ í™•ì¸ í•˜ì—¬
>
> í¸ë„ì¸ì§€ ì™•ë³µì¸ì§€ ê²°ì •í•˜ì—¬ ìµœì¢… ì·¨ì†Œê¸ˆì•¡ì„ ì‚°ì •í•˜ë„ë¡ í•˜ì˜€ê³ 
>
> ê·¸ë ‡ê²Œ ê³„ì‚°ëœ ì·¨ì†Œê¸ˆì•¡ì„ ê²°ì œê¸ˆì•¡ ë° ì ë¦½ê¸ˆì‚¬ìš© ê¸ˆì•¡ê³¼ ë¹„êµí•˜ì—¬
>
> ìµœì¢…ì ìœ¼ë¡œ ê²°ì œê¸ˆì•¡ ë˜ëŠ” ì ë¦½ê¸ˆìœ¼ë¡œ ë°˜í™˜í•˜ë„ë¡ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤.
<br/>
<h3>ğŸ’¡ì½”ë“œ ë¶„ì„</h3>

<h4>ğŸ’£Survice</h4>

```java
// ê²°ì œ ì·¨ì†Œ ê´€ë ¨ ë©”ì†Œë“œ(ê³µìš©í™”)-ì¼ê´„ì²˜ë¦¬ ê°€ëŠ¥í•˜ë„ë¡ Listë¡œ ì§„í–‰
@Transactional(rollbackFor = Exception.class)
private Map<String, Object> cancelPayment(List<Integer> pkNumberList) throws Exception {
	Map<String, Object> result = new HashMap<String, Object>();
	// ì·¨ì†Œ ì„±ê³µ List
	List<Integer> successList = new ArrayList<Integer>();
	// ì·¨ì†Œ ì‹¤íŒ¨ List
	List<AdminCancelFailDTO> failList = new ArrayList<AdminCancelFailDTO>();
	List<AdminCancelReturnDTO> cancelReturnList = new ArrayList<AdminCancelReturnDTO>();

	for (int i = 0; i < pkNumberList.size(); i++) {
		// ì·¨ì†Œ ë°ì´í„° ìˆ˜ì§‘
		AdminCancelDataDTO AdminCancelData = cancellationReturnDao.getCancelData(pkNumberList.get(i));
		// ì¹´ë“œ+í˜„ê¸ˆ ê°€ê²©
		int check_pay = AdminCancelData.getChecksum();
		// ì·¨ì†Œ,ë°˜í’ˆ ì·¨ì†Œì‹ ì²­ ê¸ˆì•¡
		int cancel_pay = AdminCancelData.getCancel_request_amount();
		// ì´ê²°ì œê¸ˆì•¡ - ì·¨ì†Œ ìš”ì²­ê¸ˆì•¡ (ê³„ì† ë¬´ë£Œë°°ì†¡ì´ ìœ ì§€ë˜ëŠ”ì§€ í™•ì¸)
		int postYN = AdminCancelData.getTotal_pay_money() - AdminCancelData.getCancel_request_amount();
		// ê³¼ì‹¤ ì—¬ë¶€ì— ë”°ë¼ ë°°ì†¡ë¹„ ì¸¡ì •
		if (AdminCancelData.getWhat().equals("ë°˜í’ˆ") && AdminCancelData.getNegligence().equals("N")) {
			// ì†Œë¹„ì ê³¼ì‹¤ (íƒë°°ë¹„ ë°œìƒ)
			int postMoney = 2500;
			// ì´ê²°ì œê¸ˆì•¡ - ì·¨ì†Œìš”ì²­ê¸ˆì•¡ì„ í–ˆì„ì‹œ ë°°ì†¡ë¹„ ë¬´ë£Œê¸°ì¤€ì— ë¶€í•©í•˜ëŠ”ì§€
			if(postYN >= 50000) {
				// ë¬´ë£Œê¸°ì¤€ ë¶€í•© -> (í¸ë„) ë°°ì†¡ë¹„ ì ìš©
				AdminCancelData.setAdd_post_money(postMoney);
				cancel_pay = cancel_pay - postMoney;
			} else if(postYN < 50000) {
				if (AdminCancelData.getPost_money() == 0) {
				// ê¸°ì¡´ì— ë°°ì†¡ë¹„ ì—†ì´ ë°°ì†¡ -> (ì™•ë³µ) ë°°ì†¡ë¹„ ì ìš©
					AdminCancelData.setAdd_post_money(2 * postMoney);
					cancel_pay = cancel_pay - (2 * postMoney);
				} else if (AdminCancelData.getPost_money() != 0) {
					// ê¸°ì¡´ì— ë°°ì†¡ë¹„ ê²°ì œ
					// (í¸ë„) ë°°ì†¡ë¹„ ì ìš©
					AdminCancelData.setAdd_post_money(postMoney);
					cancel_pay = cancel_pay - postMoney;
				}
			}					
		}

		int point_amount = 0;
		int cancel_amount= 0;
		// ì¹´ë“œ&í˜„ê¸ˆ or ì ë¦½ê¸ˆ ì·¨ì†Œê¸ˆì•¡ ê³„ì‚°
		if (cancel_pay > check_pay) { 
			// ì ë¦½ê¸ˆ ì·¨ì†Œ ê¸ˆì•¡  
			point_amount = cancel_pay - check_pay;
			// ì¹´ë“œorí˜„ê¸ˆ ì·¨ì†Œ ê¸ˆì•¡
			cancel_amount = check_pay;
		} else if (cancel_pay <= check_pay) {
			// ì¹´ë“œorí˜„ê¸ˆ ì·¨ì†Œ ê¸ˆì•¡
			cancel_amount = cancel_pay;
		}
		// ì¹´ë“œorí˜„ê¸ˆ ê¸ˆì•¡ ì„¤ì • 
		AdminCancelData.setChange_cancel_amount(cancel_amount);
		// ë³€ê²½ëœ ì ë¦½ê¸ˆ ê¸ˆì•¡ ì„¤ì •
		AdminCancelData.setChange_point_pay_money(point_amount);

		if (AdminCancelData.getPay_method().equals("ì¹´ë“œ")) {
			// ê²°ì œ ì·¨ì†Œ API
			// ê²°ì œ ì²˜ë¦¬ì— í•„ìš”í•œ DTO ìƒì„±
			CancelDataDTO cancelData = new CancelDataDTO(AdminCancelData.getImp_uid(), new BigDecimal(AdminCancelData.getCancel_request_amount()),
			AdminCancelData.getReason(), new BigDecimal(AdminCancelData.getChecksum()));
			// ê²°ì œ API í˜¸ì¶œí•˜ì—¬ ì·¨ì†Œì§„í–‰
			IamportResponse<Payment> response = PaymentInfo.getInstance().cancelPaymentByImpUid(cancelData);

			if (response.getCode() == 0) {
				// ì·¨ì†Œ ì„±ê³µ
				if (paymentDao.updatePaymentOnCancel(AdminCancelData) == 1) {
					// ì ë¦½ê¸ˆë°˜í™˜ì´ ìˆë‹¤ë©´ ì ë¦½ê¸ˆ ë°˜í™˜ë¡œê·¸ ì‘ì„± ë° ë©¤ë²„ ì ë¦½ê¸ˆ ë°˜í™˜
					if(AdminCancelData.getChange_point_pay_money() != 0) {
						if(pointsUsageLogDao.insertCancelPoint(AdminCancelData) == 1) {
							if(memberDao.updateCancelPoint(AdminCancelData) != 1) {
								// ì‹¤íŒ¨ì‹œ ë¡œì§
								throw new Exception();
							}
						} else {
							throw new Exception();
						}
					}		
					// ì„±ê³µ ë¦¬ìŠ¤íŠ¸ì— ë‹´ê¸°
					successList.add(AdminCancelData.getPk_number());
					// payment í…Œì´ë¸” ê°€ê²©ë“¤ ì—…ë°ì´íŠ¸
					Timestamp now = new Timestamp(System.currentTimeMillis());
					AdminCancelReturnDTO cancelReturnData = new AdminCancelReturnDTO(AdminCancelData.getPk_number(),
					"ì™„ë£Œ", null, now, AdminCancelData.getAdd_post_money());
					cancelReturnList.add(cancelReturnData);
				} else {
					throw new Exception();
				}
			} else if (response.getCode() == 1) {
				// ì·¨ì†Œ ì‹¤íŒ¨ ë¦¬ìŠ¤íŠ¸ì— ë‹´ê¸°
				AdminCancelFailDTO fail = new AdminCancelFailDTO(AdminCancelData.getPk_number(), response.getMessage());
				failList.add(fail);
			}
		} else if (AdminCancelData.getPay_method().equals("í˜„ê¸ˆ")) {
			// í˜„ê¸ˆê²°ì œ(ë¬´ì¡°ê±´ ì„±ê³µ)
			if (paymentDao.updatePaymentOnCancel(AdminCancelData) == 1) {
				// ì ë¦½ê¸ˆë°˜í™˜ì´ ìˆë‹¤ë©´ ì ë¦½ê¸ˆ ë°˜í™˜ë¡œê·¸ ì‘ì„± ë° ë©¤ë²„ ì ë¦½ê¸ˆ ë°˜í™˜
				if(AdminCancelData.getChange_point_pay_money() != 0) {
					if(pointsUsageLogDao.insertCancelPoint(AdminCancelData) == 1) {
						if(memberDao.updateCancelPoint(AdminCancelData) != 1) {
							//ì‹¤íŒ¨ì‹œ ë¡œì§
							throw new Exception();
						} 	
					} else {
						throw new Exception();
					}
				}
				// ì„±ê³µ ë¦¬ìŠ¤íŠ¸ì— ë‹´ê¸°
				successList.add(AdminCancelData.getPk_number());
				// payment í…Œì´ë¸” ê°€ê²©ë“¤ ì—…ë°ì´íŠ¸
				Timestamp now = new Timestamp(System.currentTimeMillis());
				AdminCancelReturnDTO cancelReturnData = new AdminCancelReturnDTO(AdminCancelData.getPk_number(),
				"ì™„ë£Œ", null, now, AdminCancelData.getAdd_post_money());
				cancelReturnList.add(cancelReturnData);
			} else {
				throw new Exception();
			}
		}
	}
	result.put("successList", successList);
	result.put("failList", failList);
	result.put("cancelReturnList", cancelReturnList);

	return result;
}

//--------------------------------------------------------------------------------------------------------------------------------
// ì·¨ì†Œì™„ë£Œí›„ DBì— ë°ì´í„° ì €ì¥í•˜ëŠ” ë¡œì§êµ¬í˜„
@Override
@Transactional(rollbackFor = Exception.class)
public Map<String, Object> changeStateReturnByComplete(List<Integer> returnNoList) throws Exception {
	Boolean verify = false;
	Map<String, Object> failListMap = new HashMap<String, Object>();

	// ì·¨ì†Œ ê³µìš© ë©”ì„œë“œ ê°”ë‹¤ì˜¤ê¸°
	Map<String, Object> result = cancelPayment(returnNoList);

	List<Integer> successList = (List<Integer>) result.get("successList");
	List<AdminCancelFailDTO> failList = (List<AdminCancelFailDTO>) result.get("failList");
	List<AdminCancelReturnDTO> returnList = (List<AdminCancelReturnDTO>) result.get("cancelReturnList");

	// ì·¨ì†Œ/ë°˜í’ˆí…Œì´ë¸”(í•œë²ˆì—) ì—…ë°ì´íŠ¸ returnList= ì„±ê³µí•œì• ë“¤ ìƒíƒœë³€ê²½ì— ë§ê²Œ ê°ì²´í™”
	if (successList.size() > 0) {
		// ë°˜ì¶œí…Œì´ë¸” ì ìš©
		if(carryinOut(successList, "ë°˜í’ˆ")) {
			// ìƒíƒœ ì™„ë£Œë¡œ ë³€ê²½
			if (cancellationReturnDao.updateCancelReturnByStateComplete(returnList, "ë°˜í’ˆ") == returnList.size()) {
				// ì •ë³´ ê²€ì¦í•˜ëŸ¬ ë°”ë¡œê°€ê¸° 
				List<String> compareMerchantUidList = ordersheetDao.compareCompleteStateCancelReturn(successList);
				if (compareMerchantUidList.size() > 0) {
					verify = verifyTotalState(compareMerchantUidList);
				} else {
					// DB ì €ì¥ì€ ì„±ê³µí–ˆì§€ë§Œ, ê²€ì¦ì— í†µê³¼í•œê²ƒì´ 0ê°œì´ë‹¤.
					verify = true;
				}
			}
		}			
	} else {
		// API ì·¨ì†Œ ì„±ê³µí•œê²ƒì´ í•œê°œë„ ì—†ë‹¤.
		verify = true;
	}
		
	if(verify) {
		failListMap.put("failList", failList);
	} else {
		throw new Exception();
	}

	return failListMap;
}
```
</br>
<h3>ğŸ’¥í‰ê°€</h3>

> ë¶€ë¶„ì·¨ì†Œ êµ¬í˜„ì— ìˆì–´ ì ë¦½ê¸ˆì‚¬ìš©ê³¼ ë°°ì†¡ë¹„ ê´€ë ¨í•˜ì—¬ ë„ˆë¬´ ì–´ë µê²Œ êµ¬í˜„í•˜ê²Œ ëœê±° ê°™ë‹¤.
>
> ì´ ë¶€ë¶„ì— ìˆì–´ ì¡°ê¸ˆ ë” ì¢‹ì€ ì„¤ê³„ë¥¼ í•˜ì˜€ìœ¼ë©´ ê¹”ë”í•˜ê²Œ êµ¬í˜„ í•  ìˆ˜ ìˆì—ˆì„ ê²ƒ ê°™ì€ë° ì§€ê¸ˆê¹Œì§€ëŠ” ë‹¤ë¥¸ ë°©ë²•ì´ ë– ì˜¤ë¥´ì§€ ì•Šì•„ì„œ
>
> ê³„ì† ê³ ë¯¼í•´ ë´ì•¼ í•  ë¬¸ì œì¸ê²ƒ ê°™ë‹¤.
>
> API ì·¨ì†Œë¥¼ ì‹¤íŒ¨í•œ ê²½ìš° ì´ë¥¼ ë”°ë¡œ ë¶„ë¥˜í•´ ì‚¬ìš©ìì—ê²Œ ì•ˆë‚´ í›„ í¸ë¦¬í•˜ê²Œ ë‹¤ì‹œ ì‘ì—… í•  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ê³  ì‹¶ì—ˆì§€ë§Œ
> 
> failListë¡œ êµ¬ë¶„ ì´í›„ì˜ ë¡œì§ì„ êµ¬í˜„í•˜ì§€ ëª»í•˜ì—¬ì„œ ì´ ë¶€ë¶„ì„ ì¡°ê¸ˆ ë” ë³´ì™„í•˜ì—¬ êµ¬í˜„í•´ì•¼ í•  ê²ƒ ê°™ê³ ,
>
> ë˜ APIì—ì„œëŠ” ì„±ê³µí•˜ì˜€ì§€ë§Œ DBì €ì¥ì‹œ ì‹¤íŒ¨í•˜ì—¬ API ì„œë²„ì™€ DBë°ì´í„°ì˜ ë¶ˆì¼ì¹˜ê°€ ì¼ì–´ë‚  ìˆ˜ ìˆëŠ”ë° ì´ë¶€ë¶„ì— ëŒ€í•œ ì²˜ë¦¬ë„ ì—†ë‹¤.
>
> ì´ ë¶€ë¶„ì„ ì„¤ê³„ ë‹¨ê³„ì—ì„œ ì „í˜€ ê³ ë ¤í•˜ì§€ ëª»í•˜ì˜€ê³  ì¶”í›„ì— êµ¬í˜„í•˜ë ¤ê³  í•˜ë‹ˆ ë„ˆë¬´ í° ì‘ì—…ì´ ë˜ì–´ ì§„í–‰í•˜ì§€ ëª»í•˜ì˜€ë‹¤.
>
> ë‹¤ìŒì— ì´ë¶€ë¶„ê¹Œì§€ ê³ ë ¤í•˜ì—¬ í…Œì´ë¸” êµ¬ì¡°ë¥¼ ë§Œë“¤ì–´ ê¹”ë”í•˜ê²Œ êµ¬í˜„í•´ë³´ê³  ì‹¶ë‹¤.
***
<br/>
<br/>
<h2>ğŸ“ìƒíƒœ í™•ì •</h2>
<img width="900" alt="ìƒíƒœ í™•ì •" src="https://github.com/SsongYT/BrickFarm-Project/assets/136442036/eb8432a8-8856-45f7-8c43-a833325ab220"/>

> detailed_orderë“¤ì˜ ìƒíƒœê°€ ëª¨ë‘ ì™„ë£Œê°€ ë˜ë©´ ordersheetì˜ ìµœì¢…ìƒíƒœê°€ ì™„ë£Œë¡œ ë³€ê²½ë˜ê³  ì ë¦½ê¸ˆ ì§€ê¸‰ì„ í•˜ë„ë¡ ì„¤ê³„ë¥¼ í•˜ê²Œ ë˜ì—ˆë‹¤.
>
> ë”°ë¼ì„œ 1ê°€ì§€ì˜ detailed_orderì˜ ìƒíƒœê°€ ì™„ë£Œìƒíƒœ(ì·¨ì†Œì™„ë£Œ,êµí™˜ì™„ë£Œ,ë°˜í’ˆì™„ë£Œ,êµ¬ë§¤í™•ì •)ê°€ ë˜ì—ˆì„ë•Œ
>
> ê°™ì€ ordersheetì— ë¬¶ì—¬ìˆëŠ” ëª¨ë“  detailed_orderì˜ ìƒíƒœë¥¼ í™•ì¸í•˜ê³ 
>
> ê·¸ ëª¨ë“  ìƒíƒœê°€ ì™„ë£Œê°€ ë˜ì—ˆì„ì‹œ ì ë¦½ê¸ˆ ì§€ê¸‰ ë° ìµœì¢…ìƒíƒœ ë³€ê²½ì„ í•˜ë„ë¡ êµ¬í˜„í•˜ì˜€ë‹¤.
<br/>
<h3>ğŸ’¡ì½”ë“œ ë¶„ì„</h3>

<h4>ğŸ’£Mapper</h4>

> DBì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ í›„ Surviceë‹¨ì—ì„œ ë¹„êµë¥¼ í•˜ëŠ” ì‘ì—…ì€ ë¹„íš¨ìœ¨ì ì´ë¼ ìƒê°í•˜ì—¬
>
> mybatisì˜ ë™ì ì¿¼ë¦¬ë¥¼ ì´ìš©í•˜ì—¬ ì¿¼ë¦¬ì—ì„œ ë¹„êµ í›„ ì¡°ê±´ì— ë§ëŠ” merchant_uidë¥¼ ë°˜í™˜í•˜ë„ë¡ ì¿¼ë¦¬ë¥¼ êµ¬í˜„í•˜ì—¬ í•´ê²°í•˜ì˜€ë‹¤.

```java
<select id="compareCompleteStateByUid" resultType="String">
SELECT B.merchant_uid 
FROM 
	(SELECT COUNT(*) AS complete, D.merchant_uid 
	FROM detailed_order D 
		LEFT OUTER JOIN exchange E 
			ON D.detailed_order_no = E.detailed_order_no 
		LEFT OUTER JOIN cancellation_return CR 
			ON D.detailed_order_no = CR.detailed_order_no 
	WHERE D.merchant_uid 
		IN 
		<foreach collection="merchantUidList" item="item" open="(" close=")" separator=",">
		#{item}
		</foreach>
		AND ((D.payment_state IN ("êµ¬ë§¤í™•ì •")) 
			OR (D.payment_state IN ("ì·¨ì†Œ","ë°˜í’ˆ") AND CR.state = "ì™„ë£Œ") 
			OR (D.payment_state IN ("êµí™˜") AND E.state = "ì™„ë£Œ")) 
	GROUP BY D.merchant_uid) A 
	INNER JOIN 
	(SELECT COUNT(*) AS total, D.merchant_uid 
	FROM detailed_order D
	WHERE D.merchant_uid
		IN 
		<foreach collection="merchantUidList" item="item" open="(" close=")" separator=",">
		#{item}
		</foreach>
	GROUP BY D.merchant_uid) B 
		ON A.merchant_uid = B.merchant_uid 
		AND A.complete = B.total 
GROUP BY B.merchant_uid
</select>
```
<h4>ğŸ’£Survice</h4>

```java
// ìµœì¢… ì™„ë£Œ ìƒíƒœë¡œ ë³€ê²½í•´ì•¼í•˜ëŠ” merchant_uid ë³€ê²½í•˜ëŠ” ë©”ì„œë“œ
@Transactional(rollbackFor = Exception.class)
private boolean verifyTotalState(List<String> compareMerchantUidList) throws Exception {
	boolean result = false;
	Timestamp now = new Timestamp(System.currentTimeMillis());
	// ì£¼ë¬¸ì„œì˜ ìµœì¢…ìƒíƒœ ë³€ê²½
	if (ordersheetDao.updateOrderSheetOnState(compareMerchantUidList, now) == compareMerchantUidList.size()) {
		// ê²°ì œì•¡ 0ì›ì´ ì•„ë‹Œ List
		List<String> haveToMerchantUidList = paymentDao.selectPaymentMoney(compareMerchantUidList);
		// í¬ì¸íŠ¸ ì ë¦½ë¡œê·¸ì— ì ë¦½
		if(haveToMerchantUidList.size() > 0) {
			if (pointsAccrualLogDao.insertPointAccrualLogByCompletion(haveToMerchantUidList) == haveToMerchantUidList.size()) {
				int count = 0;
				for(String haveToMerchantUid : haveToMerchantUidList) {
					count += memberDao.updateMemberOnAccumulate(haveToMerchantUid);
				}
				if(count == haveToMerchantUidList.size()) {
					result = true;
				}
			} 
		} else {
			result = true;
		}
	}
	return result;
}

//--------------------------------------------------------------------------------------------------------------------------------------
// ì·¨ì†Œì™„ë£Œ ìƒíƒœ ë³€ê²½
@Override
@Transactional(rollbackFor = Exception.class)
public boolean changeStateExchangeByComplete(List<AdminExchangeDTO> exchangeList, List<Integer> exchangeNoList) throws Exception {
	boolean result = false;
	// ë°˜ì¶œí…Œì´ë¸” ì ìš©
	if(carryinOut(exchangeNoList, "êµí™˜")) {
		// êµí™˜ ìƒíƒœ ë³€ê²½
		if (exchangeDao.updateExchangeByStateComplete(exchangeList) == exchangeList.size()) {
			// ëª¨ë“  ê²€ì¦í•˜ëŸ¬ ë°”ë¡œê°€ê¸°
			List<String> compareMerchantUidList = ordersheetDao.compareCompleteStateExchange(exchangeNoList);
			if (compareMerchantUidList.size() > 0) {
				result = verifyTotalState(compareMerchantUidList);
			} else {
				result = true;
			}	
		} 
	}
	if(result == false) {
		throw new Exception();
	}
	return result;
}
```
</br>
<h3>ğŸ’¥í‰ê°€</h3>

> ì²« í…Œì´ë¸” ì„¤ê³„ ì´í›„ ë‹¤ë¥¸ ë‹´ë‹¹ìë“¤ì˜ ê¸°ëŠ¥ êµ¬í˜„ì— ì–´ë ¤ì›€ì„ ê²ªìœ¼ë©´ì„œ í…Œì´ë¸” ìˆ˜ì •ì„ í•˜ë‹¤ ë³´ë‹ˆ
>
> ìµœì¢… ìƒíƒœë¼ëŠ” ì»¬ëŸ¼ì´ ìƒê¸°ê²Œ ë˜ì—ˆê³  ì´ì— ë”°ë¼ ì ë¦½ê¸ˆ ì§€ê¸‰ë„ ê°ê°ì˜ detailed_orderì—ì„œ ì§„í–‰í•˜ë˜ê²ƒì„ ìµœì¢… ìƒíƒœë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•˜ê²Œ ë˜ì—ˆë‹¤.
>
> ì²˜ìŒ ì„¤ê³„ ë‹¨ê³„ë¶€í„° ë§Œë“¤ì–´ì§„ê²Œ ì•„ë‹ˆë‹¤ ê°‘ìê¸° ë³€ê²½ë˜ì–´ì„œ ì½”ë“œê°€ ì§€ì €ë¶„í•˜ê³  ì¿¼ë¦¬ë„ ë³µì¡í•´ ì§„ê²ƒ ê°™ë‹¤.
>
> ì„¤ê³„ ë‹¨ê³„ì—ì„œ ë¶€í„° ê³ ë ¤í•˜ì—¬ ì„¤ê³„ë¥¼ í•˜ì˜€ë‹¤ë©´ ë¶ˆí•„ìš”í•œ ì»¬ëŸ¼(total_state ë“±)ë„ ì¤„ì–´ë“¤ê³  ë˜í•œ ì¿¼ë¦¬ ë° Serviceë‹¨ë„ ê¹”ë”í•´ ì¡Œì„ê²ƒ ê°™ë‹¤.
***
</br>
<h2>ğŸ“‹ìµœì¢… í‰ê°€</h2>

> ê²°ì œ ë¶€ë¶„ì— ëŒ€í•œ ì„¤ê³„ì˜ ë¯¸í¡í•œ ë¶€ë¶„ì´ ë§ì•„ í…Œì´ë¸” ë° ì»¬ëŸ¼ êµ¬ì„±ì— ë¬¸ì œê°€ ë§ì•˜ê³  ê¸°ëŠ¥êµ¬í˜„ì´ ì–´ë ¤ì› ë‹¤.
> 
> ê²°ì œìˆ˜ë‹¨ì´ í˜„ê¸ˆì¸ì§€ ì¹´ë“œì¸ì§€ êµ¬ë¶„í•˜ëŠ” ì»¬ëŸ¼ë„ ì—†ì–´ì„œ ì¿¼ë¦¬ì—ì„œ ASì ˆì„ ì‚¬ìš©í•˜ì—¬ ë§Œë“¤ì–´ì•¼ í–ˆê³ 
>
> ë˜ detailed_orderì˜ payment_stateë„ ê²°ì œëŒ€ê¸°,ê²°ì œì™„ë£Œ,ì·¨ì†Œ,êµí™˜,ë°˜í’ˆ,êµ¬ë§¤í™•ì •ìœ¼ë¡œ ë‚˜ë‰˜ì–´ ì§€ëŠ”ë° ì·¨ì†Œ ì‹ ì²­ì„ í•˜ê²Œë˜ë©´
>
> ì´ì œí’ˆì´ ê²°ì œ ì´í›„ì— ì·¨ì†Œë¥¼ í•œê²ƒì¸ì§€ ê²°ì œë¥¼ ì•ˆí•œê²ƒì¸ì§€ êµ¬ë³„ì„ í•  ìˆ˜ ì—†ì–´ì„œ ì´ë¶€ë¶„ë„ ì¿¼ë¦¬ì—ì„œ ASì ˆì„ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„í•˜ê²Œ ë˜ì—ˆë‹¤.
>
> ë¬¸ì œì ì„ ë°œê²¬í•˜ì˜€ì„ ì‹œì—” ì½”ë“œ ì‘ì„±ì´ ë„ˆë¬´ ë§ì´ ë˜ê³  ë‹¤ë¥¸ ì¡°ì›ë“¤ë„ ìˆ˜ì •ì‚¬í•­ì´ ë§ì•„ ì§€ë‹¤ ë³´ë‹ˆ í…Œì´ë¸” êµ¬ì¡°ë¥¼ ë°”ê¾¸ê¸° í˜ë“¤ì—ˆê³ 
>
> ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ í•´ê²°í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ë”ìš± ì½”ë“œì ìœ¼ë¡œ í˜ë“  ë¶€ë¶„ì´ ë§ê³  ì‹œê°„ë„ ë§ì´ ê±¸ë¦°ê²ƒ ê°™ë‹¤.
>
> ì„¤ê³„ë‹¨ê³„ì—ì„œ ë¶€í„° ê¼¼ê¼¼í•˜ê³  ì •í™•í•˜ê²Œ ë§ì€ ì‹œê°„ì„ íˆ¬ìí•˜ì—¬ êµ¬í˜„í•˜ëŠ”ê²ƒì´ ì˜¤íˆë ¤ ë” ì½”ë“œë¥¼ ì§œëŠ”ë° í¸ë¦¬í• ê²ƒ ê°™ë‹¤.
